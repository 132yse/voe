{"version":3,"file":"voe.js","sources":["../src/h.js","../src/slave.js","../src/master.js","../src/app.js","../src/reactivity.js"],"sourcesContent":["export const TEXT = 3\r\n\r\nexport function h (type, attrs) {\r\n  let props = attrs || {}\r\n  let key = props.key || null\r\n  let children = []\r\n\r\n  for (let i = 2; i < arguments.length; i++) {\r\n    let vnode = arguments[i]\r\n    if (vnode == null || vnode === true || vnode === false) {\r\n    } else if (typeof vnode === 'string' || typeof vnode === 'number') {\r\n      children.push({ type: vnode, tag: TEXT })\r\n    } else {\r\n      children.push(vnode)\r\n    }\r\n  }\r\n\r\n  delete props.key\r\n  return { type, props, children, key }\r\n}\r\n","import { TEXT } from './h'\r\n\r\nexport function masochism (worker, config) {\r\n  worker.postMessage(0)\r\n  function patch (e) {\r\n    let patches = e.data\r\n    for (const i in patches) {\r\n      let op = patches[i]\r\n      if (op.length === 1) {\r\n        document.body.appendChild(createElement(op[0]))\r\n      }\r\n    }\r\n  }\r\n  worker.onmessage = patch\r\n}\r\n\r\nfunction createElement (vnode) {\r\n  let dom = vnode.tag === TEXT ? document.createTextNode(vnode.type) : document.createElement(vnode.type)\r\n  if (vnode.children) {\r\n    for (let i = 0; i < vnode.children.length; i++) {\r\n      dom.appendChild(createElement(vnode.children[i]))\r\n    }\r\n  }\r\n  return dom\r\n}\r\n","export function sadism (config) {\r\n  function perform (e) {\r\n    const setup = config.setup\r\n    let rootVnode = setup()\r\n    let patches = diff(null, rootVnode)\r\n    self.postMessage(patches)\r\n  }\r\n  self.onmessage = perform\r\n}\r\n\r\nlet patches = {}\r\nlet index = 0\r\n\r\nfunction diff (oldVnode, newVnode) {\r\n  if (oldVnode === newVnode) {\r\n  } else if (oldVnode == null || oldVnode.type !== newVnode.type) {\r\n    patches[index++] = [newVnode]\r\n    if (oldVnode != null) {\r\n      patches[index++] = [oldVnode, index]\r\n    }\r\n  }\r\n  return patches\r\n}\r\n","import { masochism } from './slave'\r\nimport { sadism } from './master'\r\n\r\nconst MAIN = typeof window !== 'undefined'\r\nconst PATHNAME =\r\n  MAIN &&\r\n  (function () {\r\n    const scripts = document.getElementsByTagName('script')\r\n    return scripts[scripts.length - 1].src\r\n  })()\r\n\r\nexport function app (config) {\r\n  if (MAIN) {\r\n    const worker = new Worker(PATHNAME)\r\n    masochism(worker, config)\r\n  } else {\r\n    sadism(config)\r\n  }\r\n}\r\n","const toProxy = new WeakMap()\r\nconst toRaw = new WeakMap()\r\nconst isObj = obj => typeof obj === 'object'\r\n\r\nfunction trigger () {\r\n  console.log('update')\r\n}\r\n\r\nexport function reactive (target) {\r\n  if (!isObj(target)) return target\r\n\r\n  let proxy = toProxy.get(target)\r\n  if (proxy) return proxy\r\n\r\n  if (toRaw.has(target)) return target\r\n\r\n  const handlers = {\r\n    get (target, key, receiver) {\r\n      let res = Reflect.get(target, key, receiver)\r\n      if (isObj(target[key])) {\r\n        return reactive(res)\r\n      }\r\n      return res\r\n    },\r\n    set (target, key, value, receiver) {\r\n      if (key in target) {\r\n        trigger()\r\n      }\r\n      return Reflect.set(target, key, value, receiver)\r\n    },\r\n    deleteProperty () {\r\n      return Reflect.defineProperty(target, key)\r\n    }\r\n  }\r\n\r\n  let observed = new Proxy(target, handlers)\r\n\r\n  toProxy.set(target, observed)\r\n  toRaw.set(observed, target)\r\n  \r\n  return observed\r\n}\r\n"],"names":[],"mappings":"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"}